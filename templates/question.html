{% extends 'base.html' %}
{% block head %}

    {{ super() }}

{% endblock %}
{% block header %}
{{ super() }}
{% endblock %}
{% block content %}
    <h3 class="display-6"><i class="far fa-question-circle text-warning"></i> Question</h3>
    <hr>

    <table class="table table-striped table-hover">
        <tr>
            {% for header in ['post_time', 'views', 'title', 'message', 'image'] %}
                <th>{{ header.capitalize().replace('_', ' ') }}</th>
            {% endfor %}
            <th>Tags</th>
            <th>Votes</th>
            <th>Actions</th>
        </tr>

        <tr>

                {% for data in ['post_time', 'views', 'title', 'message', 'image'] %}
                    <td class="{{ data }} align-middle">
                {% if data == "title" %}

                    <b>{{ question[data] }}</b>

                {% elif data == "image" %}
                        {% if question['image'] == 'none.jpg' %}
                            <img style="width: 50px; height: 50px" src={{ url_for('static', filename="images/none.jpg")}}  alt="">
                        {% else %}
                            <img style="width: 50px; height: 50px" src="{{ url_for('static', filename="images/questions/" + question['id']|string + "/" + question['image']) }}" alt="">
                        {% endif %}
                {% else %}

                    {{ question[data] }}

                {% endif %}
                {% endfor %}
                </td>
            <td class="align-middle">
                    {% for tag in tags %}
                        <div style="display: flex; justify-content: space-between; align-items: center">
                            <span>{{ tag['name'] }}</span>
                            <a class="btn btn-danger btn-sm m-1" href="/question/{{ question["id"] }}/tag/{{ tag["id"] }}/delete">
                                <i class="far fa-trash-alt"></i>
                            </a>
                        </div>
                    {% endfor %}

            </td>

            <td class="align-middle">
                <form action="{{ url_for('vote_on_post', entry_id=question['id'], vote_value='vote_up', entry_type='question') }}" method="post">
                    <button type="submit" class="btn btn-success btn-sm d-block mx-auto">
                       <i class="far fa-thumbs-up"></i>
                    </button>
                </form>
                <span class="badge bg-primary d-block mx-auto mt-1 mb-1" style="width: 100%;">{{ question['votes'] }}</span>
                <form action="{{ url_for('vote_on_post', entry_id=question['id'], vote_value='vote_down', entry_type='question') }}" method="post">
                    <button type="submit" class="btn btn-danger btn-sm d-block mx-auto">
                        <i class="far fa-thumbs-down"></i>
                    </button>
                </form>
            </td>

            <td class="align-middle">
                <div class="d-flex flex-column">

                <a class="btn btn-danger btn-sm mt-1" href="{{ question['id'] }}/delete">DELETE</a>
                <a class="btn btn-success btn-sm mt-1" href="{{ question['id'] }}/edit">EDIT</a>
                <a class="btn btn-primary btn-sm mt-1" href="{{ question['id'] }}/new-tag">ADD TAG</a>
                </div>
            </td>


        </tr>
    </table>

    <div id="question_respond_container">
    <div class="comments_section">
    {% if comments %}
        <h3 class="display-6">Question Comments:</h3>

        <table class="table table-striped table-hover">
            <tr>
                <th>Submission time</th>
                <th>Message</th>

                <th>Actions</th>
            </tr>
            {% for comment in comments %}
                <tr>
                    <td>{{ comment.submission_time }}</td>
                    <td class="message">{{ comment.message }}</td>
                        <td>
                            <div class="d-flex flex-column">
                            <a class="btn btn-danger btn-sm mt-1" href="../comment/{{ comment['id'] }}/delete">DELETE</a>
                            <a class="btn btn-success btn-sm mt-1" href="../comment/{{ comment['id'] }}/edit">EDIT</a>
                            </div>
                        </td>
                </tr>
            {% endfor %}

        </table>
    {% else %}
        <h3 class="display-6">No comments for question.</h3>
    {% endif %}

        <a class="btn btn-primary" href="/question/{{ question['id'] }}/add-comment">New comment</a>

    </div>
    <hr class="mt-5">


    <h3 class="display-6 mt-4"><i class="fas fa-voicemail text-warning"></i> Answers</h3>
    <hr>



        {% if  answers|length > 0  %}
            <table class="table table-striped table-hover">
                <tr>
                    {% for header in ['post_time', 'message', 'image'] %}
                        {% if header != 'comments' %}
                        <th>{{ header.capitalize().replace('_', ' ') }}</th>
                        {% endif %}
                    {% endfor %}

                    <th>Votes</th>
                    <th>Actions</th>
                    <th>Comments</th>
                </tr>

                    {% for answer in answers %}
                        <tr>
                        {% for data in ['post_time', 'message', 'image'] %}
                            {% if data != 'comments' %}
                            <td class="{{ data }} align-middle">
                                {% if data == "image" %}
                                        {% if answer[data] == 'none.jpg' %}
                                            <img style="width: 50px; height: 50px" src={{ url_for('static', filename="images/none.jpg")}}  alt="">
                                        {% else %}
                                            <img style="width: 50px; height: 50px" src="{{ url_for('static', filename="images/answers/" + answer['id']|string + "/" + answer['image']) }}" alt="">
                                        {% endif %}
                                {% else %}

                                    {{ answer[data] }}

                                {% endif %}
                            </td>
                            {% endif %}
                        {% endfor %}


                            <td class="align-middle">
                                <form action="{{ url_for('vote_on_post', entry_id=answer['id'], vote_value='vote_up', entry_type='answer') }}" method="post">
                                    <button type="submit" class="btn btn-success btn-sm d-block mx-auto">
                                        <i class="far fa-thumbs-up"></i>
                                    </button>
                                </form>
                                <span class="badge bg-primary d-block mx-auto mt-1 mb-1" style="width: 100%;">{{ answer['votes'] }}</span>
                                <form action="{{ url_for('vote_on_post', entry_id=answer['id'], vote_value='vote_down', entry_type='answer') }}" method="post">
                                    <button type="submit" class="btn btn-danger btn-sm d-block mx-auto">
                                        <i class="far fa-thumbs-down"></i>
                                    </button>
                                </form>
                            </td>

                            <td class="align-middle">
                                <div class="d-flex flex-column actions" >
                                    <a class="btn btn-danger btn-sm mt-1" href="../answer/{{ answer['id'] }}/delete">DELETE</a>
                                    <a class="btn btn-success btn-sm mt-1" href="../answer/{{ answer['id'] }}/edit">EDIT</a>
                                    <a class="btn btn-primary btn-sm mt-1" href="../answer/{{ answer['id'] }}/add-comment" method="GET">COMMENT</a>
                                </div>
                            </td>

                            <td>
                                       {% if answer['comments']|length != 0 %}
                                            <table class="table">
                                                <tr>
                                                    <th>submission time</th>
                                                    <th>times edited</th>
                                                    <th>message </th>
                                                    <th>Actions</th>
                                                </tr>

                                                {% for comment in answer['comments'] %}
                                                    <tr>
                                                        <td>{{ comment['submission_time'] }}</td>
                                                        <td>{{ comment['edited_count'] }}</td>
                                                        <td>{{ comment['message'] }}</td>
                                                        <td>
                                                            <div class="d-flex flex-column">
                                                                <a class="btn btn-danger btn-sm mt-1" href="../comment/{{ comment['id'] }}/delete">DELETE</a>
                                                                <a class="btn btn-success btn-sm mt-1" href="../comment/{{ comment['id'] }}/edit">EDIT</a>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                           </table>
                                        {% else %}
                                           No comments
                                        {% endif %}
                            </td>


                    {% endfor %}
            </tr>
            </table>
        {% else %}
            <h3 class="display-6">no answers
        {% endif %}
            <a class="btn btn-primary mt-1" href="/question/{{ question['id'] }}/add-answer">Add an answer</a>
        </div>

{% endblock %}